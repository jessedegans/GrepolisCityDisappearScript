function find(){var e=WMap.mapData.getData(["towns","wonders","islands"]),t=[];for(let[n,i]of Object.entries(e.towns))i.id>0&&175==i.points&&t.push(i);var n=Game.townId;t.sort((e,t)=>Math.abs(e.id-n)-Math.abs(t.id-n)),t.forEach(function(e){var t=document.createElement("ul"),n='<a class="gp_town_link" href="#'+generateGrepoLink(e.id,e.ix,e.iy,e.name)+'">'+e.name+"</a> || disappears : "+whenDisappear(e.protection_end);t.innerHTML='<div class="grcrt_rr_town" style="border-left: 5px solid rgb(187, 85, 17); background-color: rgba(187, 85, 17, 0.1);">'+n+"</div>",document.getElementById("DisappearTownList").appendChild(t),console.log(n)})}function generateGrepoLink(e,t,n,i){return btoa(JSON.stringify({id:parseInt(e),ix:t,iy:n,tp:"town",name:i}).replace(/[\u007f-\uffff]/g,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))}function whenDisappear(e){var t=e-5184e5-Date.now();return t>1728e5||t+timeToMidnight()+72e5>1728e5?"Next night between 2 en 4":"Players playtime is "+showNormalHoursMinutes(t)+" and will disappear the next night after 48 hours"}function timeToMidnight(){var e=new Date;return e.setHours(24),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.getTime()-(new Date).getTime()}function showNormalHoursMinutes(e){return new Date(e).toISOString().substr(11,8)}function showCityFinderWindow(){var e="Town disappear finder by Jesse",t=!1,n=null;for(var i of document.getElementsByClassName("ui-dialog-title"))i.innerHTML==e&&(t=!0,n=i);for(i of(t||(wnd=Layout.wnd.Create(Layout.wnd.TYPE_DIALOG,e)),wnd.setContent(""),document.getElementsByClassName("ui-dialog-title")))i.innerHTML==e&&(n=i);wnd.setHeight("500"),wnd.setWidth("800"),wnd.setTitle(e),title=n,frame=title.parentElement.parentElement.children[1].children[4],frame.innerHTML="";var a=document.createElement("html"),r=document.createElement("div"),o=document.createElement("head");button=document.createElement("div"),button.innerHTML='<div class="button_new" name="find towns" style="margin: 2px; " rel="#"> <div class="left"></div> <div class="right"></div> <div class="caption js-caption">Find towns<div class="effect js-effect"></div></div>',button.setAttribute("onClick","find()"),r.appendChild(button);var d=document.createElement("ul");d.style.paddingBottom="5px",d.setAttribute("id","DisappearTownList"),r.appendChild(document.createElement("br")),r.appendChild(d),a.appendChild(o),a.appendChild(r),frame.appendChild(a)}
